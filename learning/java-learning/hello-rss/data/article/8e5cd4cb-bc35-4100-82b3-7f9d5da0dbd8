<p>实在忍受不了wordpress每天大量英文垃圾评论的轰炸，基本上毫无对策，网上有很多防御办法，什么修改评论文件位置，文件名，随机字段名称，甚至包括验证码都有人测试没用。今天决定尝试我的码农办法，直接判断中文数如果比英文数少就直接标记为垃圾评论，只需要修改一个文件就可以了：</p>
<p>打开文件：</p>
<blockquote><p>wp-includes/comments.php</p></blockquote>
<p>&#160;</p>
<p>定位到#2101行：<br />
   </p>
<blockquote><p>  $data = wp_unslash( $commentdata );
</p></blockquote>
<p>在其后面添加如下代码即可：</p>
<blockquote><p><code><br />
        //ahuoo 如果中文比英文字母少 就不写入评论，认为是垃圾评论<br />
	$str = $data['comment_content'];<br />
	preg_match_all("/[0-9]{1}/",$str,$arrNum);//数字<br />
	preg_match_all("/[a-zA-Z]{1}/",$str,$arrAl);//字母<br />
	preg_match_all("/([\x{4e00}-\x{9fa5}]){1}/u",$str,$arrCh);//中文个数<br />
	if($arrCh[0]<=$arrAl[0]){ 
	   $data['comment_approved'] = 'spam';
	}
</code></p></blockquote>
