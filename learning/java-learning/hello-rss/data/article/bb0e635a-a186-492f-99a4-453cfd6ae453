<span style="font-family: inherit;">Note: This might also fail on full HR but I do not have an environment where to test this (I vaguely remember having a simliar issue from a past implementation, though).</span><br />
<span style="font-family: inherit;"><br />
When calling hr_assignment_api.update_emp_asg_criteria on a shared HR installation, the following error is returned:</span><br />
<blockquote class="tr_bq">
<span style="font-family: inherit;">ORA-20001: System Error: Procedure sort_segment_order at Step 40.</span></blockquote>
<span style="font-family: inherit;"><br />
The fix is to set the p_people_group_id parameter value to hr_api.g_number whenever it is null, which is likely every time on a shared HR install as the People Group field is not available on the Enter Person screen.</span><br />
<br />
<pre class="textmate-source solarized_dark_"><span class="linenum">    1</span> <span class="source source_oracle"><span class="variable variable_parameter">p_people_group_id</span> <span class="keyword keyword_operator keyword_operator_oracle">=&gt;</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span> new_people_group_id<span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_number</span> <span class="keyword keyword_operator keyword_operator_oracle">)</span></span>
<span class="linenum">    2</span>
</pre>
<br />
<span style="font-family: inherit;">Long story short: Oracle does not properly handle updating the value to null when the people group key flexfield is not set up. To get details on why this happens, keep on reading.</span><br />
<br />
First, we have to enable hr debug and set its destination to be dbms_output.<br />
<br />
<pre class="textmate-source solarized_dark_"><span class="linenum">    1</span> <span class="source source_oracle"><span class="variable variable_other">hr_utility.</span>trace_on <span class="keyword keyword_operator keyword_operator_oracle">;</span>
<span class="linenum">    2</span> <span class="comment comment_line comment_line_double-dash">-- API Call</span>
<span class="linenum">    3</span> <span class="variable variable_other">hr_utility.</span>trace_off <span class="keyword keyword_operator keyword_operator_oracle">;</span></span>
<span class="linenum">    4</span></pre>
<br />
Here is the last part of the trace, which besides identifying the procedure or activity being performed, also shows a number to the right, which pinpoints a specific location on the code.<br />
<br />
<pre class="textmate-source solarized_dark_"><span class="linenum">    1</span> <span class="source source_oracle">  <span class="variable variable_other">hr_assignment_api.</span>update_emp_asg_criteria                             <span class="constant constant_numeric constant_numeric_oracle">240</span>
<span class="linenum">    2</span>   <span class="variable variable_other">hr_assignment_api.</span>update_emp_asg_criteria                             <span class="constant constant_numeric constant_numeric_oracle">250</span>
<span class="linenum">    3</span> Entering:upd_or_sel_keyflex_comb                                        <span class="constant constant_numeric constant_numeric_oracle">10</span>
<span class="linenum">    4</span> upd_or_sel_keyflex_comb                                                 <span class="constant constant_numeric constant_numeric_oracle">20</span>
<span class="linenum">    5</span> Entering:check_ignore_varray                                            <span class="constant constant_numeric constant_numeric_oracle">10</span>
<span class="linenum">    6</span> Seg3 $Sys_Def$                                                         <span class="constant constant_numeric constant_numeric_oracle">101</span>
<span class="linenum">    7</span> Entering:ins_or_sel_keyflex_comb                                        <span class="constant constant_numeric constant_numeric_oracle">10</span>
<span class="linenum">    8</span> ins_or_sel_keyflex_comb                                                 <span class="constant constant_numeric constant_numeric_oracle">20</span>
<span class="linenum">    9</span> Entering:check_ignore_varray                                            <span class="constant constant_numeric constant_numeric_oracle">10</span>
<span class="linenum">   10</span> ins_or_sel_keyflex_comb                                                 <span class="constant constant_numeric constant_numeric_oracle">30</span>
<span class="linenum">   11</span> Entering:sort_segment_order                                             <span class="constant constant_numeric constant_numeric_oracle">10</span>
<span class="linenum">   12</span> sort_segment_order                                                      <span class="constant constant_numeric constant_numeric_oracle">20</span>
<span class="linenum">   13</span> sort_segment_order                                                      <span class="constant constant_numeric constant_numeric_oracle">30</span>
<span class="linenum">   14</span> sort_segment_order                                                      <span class="constant constant_numeric constant_numeric_oracle">40</span>
<span class="linenum">   15</span> ins_or_sel_keyflex_comb                                                 <span class="constant constant_numeric constant_numeric_oracle">100</span>
<span class="linenum">   16</span> Leaving upd_or_sel_keyflex_comb                                         <span class="constant constant_numeric constant_numeric_oracle">140</span>
<span class="linenum">   17</span> Leaving:  <span class="variable variable_other">hr_assignment_api.</span>update_emp_asg_criteria                    <span class="constant constant_numeric constant_numeric_oracle">999</span>
<span class="linenum">   18</span> ORA<span class="keyword keyword_operator keyword_operator_oracle">-</span><span class="constant constant_numeric constant_numeric_oracle">20001</span>: System Error: <span class="keyword keyword_other keyword_other_ddl keyword_other_ddl_oracle">Procedure</span> sort_segment_order at Step <span class="constant constant_numeric constant_numeric_oracle">40</span>
<span class="linenum">   19</span> 
<span class="linenum">   20</span> Cause:        The <span class="keyword keyword_other keyword_other_ddl keyword_other_ddl_oracle">procedure</span> sort_segment_order has created an error at Step <span class="constant constant_numeric constant_numeric_oracle">40</span><span class="keyword keyword_operator keyword_operator_oracle">.</span> 
<span class="linenum">   21</span> 
<span class="linenum">   22</span> Action:        Contact your system administrator quoting the <span class="keyword keyword_other keyword_other_ddl keyword_other_ddl_oracle">procedure</span> sort_segment_order <span class="keyword keyword_operator keyword_operator_oracle">and</span> Step <span class="constant constant_numeric constant_numeric_oracle">40</span><span class="keyword keyword_operator keyword_operator_oracle">.</span>
</span><span class="linenum">   23</span>
</pre>
<div class="p1">
<br />
On line 2 we see the last statement executed on the update API (<span class="variable variable_other">hr_assignment_api.</span>update_emp_asg_criteria), has location 250. Lines 3 to 16 (Entering...Leaving) indicates that another procedure was likely called, and on line 17 we see that the API terminates (Leaving...).<br />
<br />
We now proceed to review the hr_assignment_api API code and look for the location where debugging displays location 250, which is line 2 below.<br />
<br /></div>
<pre class="textmate-source solarized_dark_"><span class="linenum">    1</span> <span class="source source_oracle"><span class="keyword keyword_control keyword_control_pl">if</span> <span class="variable variable_other">g_debug</span> <span class="keyword keyword_control keyword_control_pl">then</span>
<span class="linenum">    2</span>   <span class="variable variable_other">hr_utility.</span>set_location<span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_other">l_proc</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="constant constant_numeric constant_numeric_oracle">250</span><span class="keyword keyword_operator keyword_operator_oracle">);</span>
<span class="linenum">    3</span> <span class="keyword keyword_control keyword_control_pl">end</span> <span class="keyword keyword_control keyword_control_pl">if</span><span class="keyword keyword_operator keyword_operator_oracle">;</span>
<span class="linenum">    4</span> <span class="comment comment_line comment_line_double-dash">  --</span>
<span class="linenum">    5</span> <span class="comment comment_line comment_line_double-dash">  -- Maintain the people group key flexfields.</span>
<span class="linenum">    6</span> <span class="comment comment_line comment_line_double-dash">  --</span>
<span class="linenum">    7</span> <span class="comment comment_line comment_line_double-dash">  -- Only call the flex code if a non-default value(includng null) is passed</span>
<span class="linenum">    8</span> <span class="comment comment_line comment_line_double-dash">  -- to the procedure.</span>
<span class="linenum">    9</span> <span class="comment comment_line comment_line_double-dash">  --</span>
<span class="linenum">   10</span> <span class="comment comment_line comment_line_double-dash">    --</span>
<span class="linenum">   11</span>   <span class="keyword keyword_control keyword_control_pl">if</span>  <span class="variable variable_other">l_pgp_null_ind</span> <span class="keyword keyword_operator keyword_operator_oracle">=</span> <span class="constant constant_numeric constant_numeric_oracle">0</span><span class="comment comment_line comment_line_double-dash"> -- bug 2359997</span>
<span class="linenum">   12</span>   <span class="keyword keyword_control keyword_control_pl">then</span>
<span class="linenum">   13</span> <span class="comment comment_line comment_line_double-dash">    --</span>
<span class="linenum">   14</span>     <span class="variable variable_other">l_people_group_id</span> <span class="keyword keyword_operator keyword_operator_oracle">:=</span> <span class="variable variable_other">per_asg_shd.g_old_rec</span><span class="keyword keyword_operator keyword_operator_oracle">.</span>people_group_id<span class="keyword keyword_operator keyword_operator_oracle">;</span>
<span class="linenum">   15</span> <span class="comment comment_line comment_line_double-dash">    -- 4103321 modified the if statement</span>
<span class="linenum">   16</span> 
<span class="linenum">   17</span>     <span class="keyword keyword_control keyword_control_pl">if</span> <span class="variable variable_other">l_people_group_id</span> <span class="keyword keyword_operator keyword_operator_oracle">is</span> <span class="keyword keyword_operator keyword_operator_oracle">not</span> <span class="constant constant_language constant_language_oracle">null</span> <span class="keyword keyword_control keyword_control_pl">then</span>
<span class="linenum">   18</span>        <span class="keyword keyword_control keyword_control_pl">open</span> <span class="variable variable_other">c_pgp_segments</span><span class="keyword keyword_operator keyword_operator_oracle">;</span>
<span class="linenum">   19</span>        <span class="keyword keyword_control keyword_control_pl">fetch</span> <span class="variable variable_other">c_pgp_segments</span> <span class="keyword keyword_operator keyword_operator_oracle">into</span> <span class="variable variable_other">l_old_pgp_segments</span><span class="keyword keyword_operator keyword_operator_oracle">;</span>
<span class="linenum">   20</span>        <span class="keyword keyword_control keyword_control_pl">close</span> <span class="variable variable_other">c_pgp_segments</span><span class="keyword keyword_operator keyword_operator_oracle">;</span>
<span class="linenum">   21</span>     <span class="keyword keyword_control keyword_control_pl">end</span> <span class="keyword keyword_control keyword_control_pl">if</span><span class="keyword keyword_operator keyword_operator_oracle">;</span>
<span class="linenum">   22</span> <span class="comment comment_line comment_line_double-dash">    --</span>
<span class="linenum">   23</span>     <span class="keyword keyword_control keyword_control_pl">if</span>   <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_parameter">p_segment1</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span> <span class="keyword keyword_operator keyword_operator_oracle">&lt;&gt;</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_other">l_old_pgp_segments</span><span class="keyword keyword_operator keyword_operator_oracle">.</span><span class="constant constant_language constant_language_oracle constant_language_oracle_apps">segment1</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span>
<span class="linenum">   24</span>       <span class="keyword keyword_operator keyword_operator_oracle">or</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_parameter">p_segment2</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span> <span class="keyword keyword_operator keyword_operator_oracle">&lt;&gt;</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_other">l_old_pgp_segments</span><span class="keyword keyword_operator keyword_operator_oracle">.</span><span class="constant constant_language constant_language_oracle constant_language_oracle_apps">segment2</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span>
<span class="linenum">   25</span>       <span class="keyword keyword_operator keyword_operator_oracle">or</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_parameter">p_segment3</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span> <span class="keyword keyword_operator keyword_operator_oracle">&lt;&gt;</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_other">l_old_pgp_segments</span><span class="keyword keyword_operator keyword_operator_oracle">.</span><span class="constant constant_language constant_language_oracle constant_language_oracle_apps">segment3</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span>
<span class="linenum">   26</span>       <span class="keyword keyword_operator keyword_operator_oracle">or</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_parameter">p_segment4</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span> <span class="keyword keyword_operator keyword_operator_oracle">&lt;&gt;</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_other">l_old_pgp_segments</span><span class="keyword keyword_operator keyword_operator_oracle">.</span><span class="constant constant_language constant_language_oracle constant_language_oracle_apps">segment4</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span>
<span class="linenum">   27</span>       <span class="keyword keyword_operator keyword_operator_oracle">or</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_parameter">p_segment5</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span> <span class="keyword keyword_operator keyword_operator_oracle">&lt;&gt;</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_other">l_old_pgp_segments</span><span class="keyword keyword_operator keyword_operator_oracle">.</span><span class="constant constant_language constant_language_oracle constant_language_oracle_apps">segment5</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span>
<span class="linenum">   28</span>       <span class="keyword keyword_operator keyword_operator_oracle">or</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_parameter">p_segment6</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span> <span class="keyword keyword_operator keyword_operator_oracle">&lt;&gt;</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_other">l_old_pgp_segments</span><span class="keyword keyword_operator keyword_operator_oracle">.</span><span class="constant constant_language constant_language_oracle constant_language_oracle_apps">segment6</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span>
<span class="linenum">   29</span>       <span class="keyword keyword_operator keyword_operator_oracle">or</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_parameter">p_segment7</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span> <span class="keyword keyword_operator keyword_operator_oracle">&lt;&gt;</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_other">l_old_pgp_segments</span><span class="keyword keyword_operator keyword_operator_oracle">.</span><span class="constant constant_language constant_language_oracle constant_language_oracle_apps">segment7</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span>
<span class="linenum">   30</span>       <span class="keyword keyword_operator keyword_operator_oracle">or</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_parameter">p_segment8</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span> <span class="keyword keyword_operator keyword_operator_oracle">&lt;&gt;</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_other">l_old_pgp_segments</span><span class="keyword keyword_operator keyword_operator_oracle">.</span><span class="constant constant_language constant_language_oracle constant_language_oracle_apps">segment8</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span>
<span class="linenum">   31</span>       <span class="keyword keyword_operator keyword_operator_oracle">or</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_parameter">p_segment9</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span> <span class="keyword keyword_operator keyword_operator_oracle">&lt;&gt;</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_other">l_old_pgp_segments</span><span class="keyword keyword_operator keyword_operator_oracle">.</span><span class="constant constant_language constant_language_oracle constant_language_oracle_apps">segment9</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span>
<span class="linenum">   32</span>       <span class="keyword keyword_operator keyword_operator_oracle">or</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_parameter">p_segment10</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span> <span class="keyword keyword_operator keyword_operator_oracle">&lt;&gt;</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_other">l_old_pgp_segments</span><span class="keyword keyword_operator keyword_operator_oracle">.</span><span class="constant constant_language constant_language_oracle constant_language_oracle_apps">segment10</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span>
<span class="linenum">   33</span>       <span class="keyword keyword_operator keyword_operator_oracle">or</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_parameter">p_segment11</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span> <span class="keyword keyword_operator keyword_operator_oracle">&lt;&gt;</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_other">l_old_pgp_segments</span><span class="keyword keyword_operator keyword_operator_oracle">.</span><span class="constant constant_language constant_language_oracle constant_language_oracle_apps">segment11</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span>
<span class="linenum">   34</span>       <span class="keyword keyword_operator keyword_operator_oracle">or</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_parameter">p_segment12</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span> <span class="keyword keyword_operator keyword_operator_oracle">&lt;&gt;</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_other">l_old_pgp_segments</span><span class="keyword keyword_operator keyword_operator_oracle">.</span><span class="constant constant_language constant_language_oracle constant_language_oracle_apps">segment12</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span>
<span class="linenum">   35</span>       <span class="keyword keyword_operator keyword_operator_oracle">or</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_parameter">p_segment13</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span> <span class="keyword keyword_operator keyword_operator_oracle">&lt;&gt;</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_other">l_old_pgp_segments</span><span class="keyword keyword_operator keyword_operator_oracle">.</span><span class="constant constant_language constant_language_oracle constant_language_oracle_apps">segment13</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span>
<span class="linenum">   36</span>       <span class="keyword keyword_operator keyword_operator_oracle">or</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_parameter">p_segment14</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span> <span class="keyword keyword_operator keyword_operator_oracle">&lt;&gt;</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_other">l_old_pgp_segments</span><span class="keyword keyword_operator keyword_operator_oracle">.</span><span class="constant constant_language constant_language_oracle constant_language_oracle_apps">segment14</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span>
<span class="linenum">   37</span>       <span class="keyword keyword_operator keyword_operator_oracle">or</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_parameter">p_segment15</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span> <span class="keyword keyword_operator keyword_operator_oracle">&lt;&gt;</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_other">l_old_pgp_segments</span><span class="keyword keyword_operator keyword_operator_oracle">.</span><span class="constant constant_language constant_language_oracle constant_language_oracle_apps">segment15</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span>
<span class="linenum">   38</span>       <span class="keyword keyword_operator keyword_operator_oracle">or</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_parameter">p_segment16</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span> <span class="keyword keyword_operator keyword_operator_oracle">&lt;&gt;</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_other">l_old_pgp_segments</span><span class="keyword keyword_operator keyword_operator_oracle">.</span><span class="constant constant_language constant_language_oracle constant_language_oracle_apps">segment16</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span>
<span class="linenum">   39</span>       <span class="keyword keyword_operator keyword_operator_oracle">or</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_parameter">p_segment17</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span> <span class="keyword keyword_operator keyword_operator_oracle">&lt;&gt;</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_other">l_old_pgp_segments</span><span class="keyword keyword_operator keyword_operator_oracle">.</span><span class="constant constant_language constant_language_oracle constant_language_oracle_apps">segment17</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span>
<span class="linenum">   40</span>       <span class="keyword keyword_operator keyword_operator_oracle">or</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_parameter">p_segment18</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span> <span class="keyword keyword_operator keyword_operator_oracle">&lt;&gt;</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_other">l_old_pgp_segments</span><span class="keyword keyword_operator keyword_operator_oracle">.</span><span class="constant constant_language constant_language_oracle constant_language_oracle_apps">segment18</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span>
<span class="linenum">   41</span>       <span class="keyword keyword_operator keyword_operator_oracle">or</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_parameter">p_segment19</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span> <span class="keyword keyword_operator keyword_operator_oracle">&lt;&gt;</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_other">l_old_pgp_segments</span><span class="keyword keyword_operator keyword_operator_oracle">.</span><span class="constant constant_language constant_language_oracle constant_language_oracle_apps">segment19</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span>
<span class="linenum">   42</span>       <span class="keyword keyword_operator keyword_operator_oracle">or</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_parameter">p_segment20</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span> <span class="keyword keyword_operator keyword_operator_oracle">&lt;&gt;</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_other">l_old_pgp_segments</span><span class="keyword keyword_operator keyword_operator_oracle">.</span><span class="constant constant_language constant_language_oracle constant_language_oracle_apps">segment20</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span>
<span class="linenum">   43</span>       <span class="keyword keyword_operator keyword_operator_oracle">or</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_parameter">p_segment21</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span> <span class="keyword keyword_operator keyword_operator_oracle">&lt;&gt;</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_other">l_old_pgp_segments</span><span class="keyword keyword_operator keyword_operator_oracle">.</span><span class="constant constant_language constant_language_oracle constant_language_oracle_apps">segment21</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span>
<span class="linenum">   44</span>       <span class="keyword keyword_operator keyword_operator_oracle">or</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_parameter">p_segment22</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span> <span class="keyword keyword_operator keyword_operator_oracle">&lt;&gt;</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_other">l_old_pgp_segments</span><span class="keyword keyword_operator keyword_operator_oracle">.</span><span class="constant constant_language constant_language_oracle constant_language_oracle_apps">segment22</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span>
<span class="linenum">   45</span>       <span class="keyword keyword_operator keyword_operator_oracle">or</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_parameter">p_segment23</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span> <span class="keyword keyword_operator keyword_operator_oracle">&lt;&gt;</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_other">l_old_pgp_segments</span><span class="keyword keyword_operator keyword_operator_oracle">.</span><span class="constant constant_language constant_language_oracle constant_language_oracle_apps">segment23</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span>
<span class="linenum">   46</span>       <span class="keyword keyword_operator keyword_operator_oracle">or</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_parameter">p_segment24</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span> <span class="keyword keyword_operator keyword_operator_oracle">&lt;&gt;</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_other">l_old_pgp_segments</span><span class="keyword keyword_operator keyword_operator_oracle">.</span><span class="constant constant_language constant_language_oracle constant_language_oracle_apps">segment24</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span>
<span class="linenum">   47</span>       <span class="keyword keyword_operator keyword_operator_oracle">or</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_parameter">p_segment25</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span> <span class="keyword keyword_operator keyword_operator_oracle">&lt;&gt;</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_other">l_old_pgp_segments</span><span class="keyword keyword_operator keyword_operator_oracle">.</span><span class="constant constant_language constant_language_oracle constant_language_oracle_apps">segment25</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span>
<span class="linenum">   48</span>       <span class="keyword keyword_operator keyword_operator_oracle">or</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_parameter">p_segment26</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span> <span class="keyword keyword_operator keyword_operator_oracle">&lt;&gt;</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_other">l_old_pgp_segments</span><span class="keyword keyword_operator keyword_operator_oracle">.</span><span class="constant constant_language constant_language_oracle constant_language_oracle_apps">segment26</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span>
<span class="linenum">   49</span>       <span class="keyword keyword_operator keyword_operator_oracle">or</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_parameter">p_segment27</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span> <span class="keyword keyword_operator keyword_operator_oracle">&lt;&gt;</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_other">l_old_pgp_segments</span><span class="keyword keyword_operator keyword_operator_oracle">.</span><span class="constant constant_language constant_language_oracle constant_language_oracle_apps">segment27</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span>
<span class="linenum">   50</span>       <span class="keyword keyword_operator keyword_operator_oracle">or</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_parameter">p_segment28</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span> <span class="keyword keyword_operator keyword_operator_oracle">&lt;&gt;</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_other">l_old_pgp_segments</span><span class="keyword keyword_operator keyword_operator_oracle">.</span><span class="constant constant_language constant_language_oracle constant_language_oracle_apps">segment28</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span>
<span class="linenum">   51</span>       <span class="keyword keyword_operator keyword_operator_oracle">or</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_parameter">p_segment29</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span> <span class="keyword keyword_operator keyword_operator_oracle">&lt;&gt;</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_other">l_old_pgp_segments</span><span class="keyword keyword_operator keyword_operator_oracle">.</span><span class="constant constant_language constant_language_oracle constant_language_oracle_apps">segment29</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span>
<span class="linenum">   52</span>       <span class="keyword keyword_operator keyword_operator_oracle">or</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_parameter">p_segment30</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span> <span class="keyword keyword_operator keyword_operator_oracle">&lt;&gt;</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_other">l_old_pgp_segments</span><span class="keyword keyword_operator keyword_operator_oracle">.</span><span class="constant constant_language constant_language_oracle constant_language_oracle_apps">segment30</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span>
<span class="linenum">   53</span>       <span class="keyword keyword_operator keyword_operator_oracle">or</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_other">l_old_group_name</span><span class="keyword keyword_operator keyword_operator_oracle">,</span><span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span> <span class="keyword keyword_operator keyword_operator_oracle">&lt;&gt;</span> <span class="support support_function support_function_oracle">nvl</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_other">l_old_pgp_segments</span><span class="keyword keyword_operator keyword_operator_oracle">.</span>group_name<span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">hr_api.g_varchar2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span>
<span class="linenum">   54</span>       <span class="keyword keyword_operator keyword_operator_oracle">or</span> <span class="variable variable_other">l_people_group_id</span> <span class="keyword keyword_operator keyword_operator_oracle">is</span>  <span class="constant constant_language constant_language_oracle">null</span><span class="comment comment_line comment_line_double-dash"> -- fix for bug 4633742.</span>
<span class="linenum">   55</span>     <span class="keyword keyword_control keyword_control_pl">then</span>
<span class="linenum">   56</span>       <span class="variable variable_other">hr_kflex_utility.</span>upd_or_sel_keyflex_comb
<span class="linenum">   57</span>       <span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_parameter">p_appl_short_name</span>              <span class="keyword keyword_operator keyword_operator_oracle">=&gt;</span> <span class="string string_quoted string_quoted_single string_quoted_single_oracle">'PAY'</span>
<span class="linenum">   58</span>       <span class="keyword keyword_operator keyword_operator_oracle">,</span><span class="variable variable_parameter">p_flex_code</span>                    <span class="keyword keyword_operator keyword_operator_oracle">=&gt;</span> <span class="string string_quoted string_quoted_single string_quoted_single_oracle">'GRP'</span>
<span class="linenum">   59</span> 
<span class="linenum">   60</span> <span class="comment comment_line comment_line_double-dash">      -- More code...</span></span>
<span class="linenum">   61</span></pre>
<div class="p1">
<br />
Line 11 indicates branching based on an indicator about people group id being null. We know this code is executed as hr_kflex_utility.upd_or_sel_keyflex_comb debug information is what shows on dbms_output; this is avoided by passing hr_api.g_default number, yet it will bomb if you try passing any other not null value (more on that later). Culprit is line 54, which makes no sense as this means that both original and updated values are null, which indicates no change and thus no need to call for flexfield validation. There might be a reason, though, as the comment indicates a bug number; however, as mentioned before, this should not be done when using shared HR as it bombs. If you are curious you'll find that the code fails on procedure hr_kflex_utility.sort_segment_order which validates a counter to be increased on a loop, which is not executed due to people group KFF not being set up.</div>
<div class="p1">
<br /></div>
<div class="p1">
The cursor that retrieves no values.<br />
<br /></div>
<pre class="textmate-source solarized_dark_"><span class="linenum">    1</span> <span class="source source_oracle"><span class="storage storage_type storage_type_oracle">cursor</span> get_pop_segs <span class="keyword keyword_operator keyword_operator_oracle">is</span>
<span class="linenum">    2</span>   <span class="keyword keyword_other keyword_other_dml keyword_other_dml_oracle">select</span> <span class="support support_function support_function_oracle">substr</span><span class="keyword keyword_operator keyword_operator_oracle">(</span>application_column_name<span class="keyword keyword_operator keyword_operator_oracle">,</span><span class="constant constant_numeric constant_numeric_oracle">8</span><span class="keyword keyword_operator keyword_operator_oracle">,</span><span class="constant constant_numeric constant_numeric_oracle">2</span><span class="keyword keyword_operator keyword_operator_oracle">)</span>
<span class="linenum">    3</span>   <span class="keyword keyword_other keyword_other_dml keyword_other_dml_oracle">from</span>   fnd_id_flex_segments_vl
<span class="linenum">    4</span>   <span class="keyword keyword_other keyword_other_dml keyword_other_dml_oracle">where</span>  id_flex_code <span class="keyword keyword_operator keyword_operator_oracle">=</span> <span class="variable variable_parameter">p_flex_code</span>
<span class="linenum">    5</span>   <span class="keyword keyword_operator keyword_operator_oracle">and</span>    id_flex_num  <span class="keyword keyword_operator keyword_operator_oracle">=</span> <span class="variable variable_parameter">p_flex_num</span>
<span class="linenum">    6</span>   <span class="keyword keyword_operator keyword_operator_oracle">and</span>    enabled_flag<span class="keyword keyword_operator keyword_operator_oracle">=</span><span class="string string_quoted string_quoted_single string_quoted_single_oracle">'Y'</span>
<span class="linenum">    7</span>   <span class="keyword keyword_operator keyword_operator_oracle">and</span>    application_id <span class="keyword keyword_operator keyword_operator_oracle">=</span> <span class="variable variable_parameter">p_application_id</span>
<span class="linenum">    8</span>   <span class="keyword keyword_other keyword_other_dml keyword_other_dml_oracle">order</span> <span class="keyword keyword_operator keyword_operator_oracle">by</span> <span class="support support_function support_function_oracle">to_number</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="support support_function support_function_oracle">substr</span><span class="keyword keyword_operator keyword_operator_oracle">(</span>application_column_name<span class="keyword keyword_operator keyword_operator_oracle">,</span><span class="constant constant_numeric constant_numeric_oracle">8</span><span class="keyword keyword_operator keyword_operator_oracle">,</span><span class="constant constant_numeric constant_numeric_oracle">2</span><span class="keyword keyword_operator keyword_operator_oracle">));</span>
</span><span class="linenum">    9</span> </pre>
<br />
The cursor retrieval, which will not populate the array.

<br />
<br />
<pre class="textmate-source solarized_dark_"><span class="linenum">    1</span> <span class="source source_oracle"><span class="comment comment_line comment_line_double-dash">--</span>
<span class="linenum">    2</span> <span class="comment comment_line comment_line_double-dash">-- Populate SORTED segment array</span>
<span class="linenum">    3</span> <span class="keyword keyword_control keyword_control_pl">open</span> get_pop_segs<span class="keyword keyword_operator keyword_operator_oracle">;</span>
<span class="linenum">    4</span> <span class="keyword keyword_control keyword_control_pl">fetch</span> get_pop_segs  BULK COLLECT <span class="keyword keyword_operator keyword_operator_oracle">into</span> <span class="variable variable_other">l_seg_no_array</span><span class="keyword keyword_operator keyword_operator_oracle">;</span>
</span><span class="linenum">    5</span> </pre>
<div class="p1">
<br />
The loop that should had set up the counter but does not execute as the array is empty.</div>
<br />
<pre class="textmate-source solarized_dark_"><span class="linenum">    1</span> <span class="source source_oracle"><span class="keyword keyword_control keyword_control_pl">for</span> j <span class="keyword keyword_operator keyword_operator_oracle">in</span> <span class="constant constant_numeric constant_numeric_oracle">1</span><span class="keyword keyword_operator keyword_operator_oracle">..</span><span class="variable variable_other">l_seg_no_array</span><span class="keyword keyword_operator keyword_operator_oracle">.</span><span class="support support_function support_function_oracle">count</span>
<span class="linenum">    2</span> <span class="keyword keyword_control keyword_control_pl">loop</span>
<span class="linenum">    3</span> <span class="comment comment_line comment_line_double-dash">  -- fetch get_seg_order into l_disp_no; -- The list of column order required by AOL</span>
<span class="linenum">    4</span> <span class="comment comment_line comment_line_double-dash">  -- fetch get_pop_segs  into l_seg_no;  -- A list of segments in column order</span>
<span class="linenum">    5</span> <span class="comment comment_line comment_line_double-dash">  -- exit when get_pop_segs%NOTFOUND;</span>
<span class="linenum">    6</span> <span class="comment comment_line comment_line_double-dash">     --</span>
<span class="linenum">    7</span> <span class="comment comment_line comment_line_double-dash">     -- Pass user defined segment values into sorted</span>
<span class="linenum">    8</span> <span class="comment comment_line comment_line_double-dash">     -- segment array</span>
<span class="linenum">    9</span> <span class="comment comment_line comment_line_double-dash">     --</span>
<span class="linenum">   10</span>      <span class="variable variable_other">l_parameter_sorted</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_other">l_seg_no_array</span><span class="keyword keyword_operator keyword_operator_oracle">(</span>j<span class="keyword keyword_operator keyword_operator_oracle">))</span> <span class="keyword keyword_operator keyword_operator_oracle">:=</span> <span class="variable variable_other">l_parameter_temp</span><span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_other">l_disp_no_array</span><span class="keyword keyword_operator keyword_operator_oracle">(</span>j<span class="keyword keyword_operator keyword_operator_oracle">));</span>
<span class="linenum">   11</span>      <span class="variable variable_other">l_seg_count</span> <span class="keyword keyword_operator keyword_operator_oracle">:=</span> <span class="variable variable_other">l_seg_count</span> <span class="keyword keyword_operator keyword_operator_oracle">+</span> <span class="constant constant_numeric constant_numeric_oracle">1</span><span class="keyword keyword_operator keyword_operator_oracle">;</span>
<span class="linenum">   12</span> <span class="comment comment_line comment_line_double-dash">     --</span>
<span class="linenum">   13</span> <span class="keyword keyword_control keyword_control_pl">end</span> <span class="keyword keyword_control keyword_control_pl">loop</span><span class="keyword keyword_operator keyword_operator_oracle">;</span>
<span class="linenum">   14</span> <span class="keyword keyword_control keyword_control_pl">close</span> get_seg_order<span class="keyword keyword_operator keyword_operator_oracle">;</span>
<span class="linenum">   15</span> <span class="keyword keyword_control keyword_control_pl">close</span> get_pop_segs<span class="keyword keyword_operator keyword_operator_oracle">;</span>
<span class="linenum">   16</span> <span class="keyword keyword_control keyword_control_pl">if</span> <span class="variable variable_other">g_debug</span> <span class="keyword keyword_control keyword_control_pl">then</span>
<span class="linenum">   17</span>  <span class="variable variable_other">hr_utility.</span>set_location<span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_other">l_proc</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="constant constant_numeric constant_numeric_oracle">40</span><span class="keyword keyword_operator keyword_operator_oracle">);</span>
<span class="linenum">   18</span> <span class="keyword keyword_control keyword_control_pl">end</span> <span class="keyword keyword_control keyword_control_pl">if</span><span class="keyword keyword_operator keyword_operator_oracle">;</span>
</span><span class="linenum">   19</span> 
</pre>
<div class="p1">
<br />
The validation that raises the error.<br />
<br /></div>
<pre class="textmate-source solarized_dark_"><span class="linenum">    1</span> <span class="source source_oracle"><span class="comment comment_line comment_line_double-dash">--</span>
<span class="linenum">    2</span> <span class="comment comment_line comment_line_double-dash">-- Verify whether sorted array has been created</span>
<span class="linenum">    3</span> <span class="comment comment_line comment_line_double-dash">--</span>
<span class="linenum">    4</span> <span class="keyword keyword_control keyword_control_pl">if</span> <span class="variable variable_other">l_seg_count</span> <span class="keyword keyword_operator keyword_operator_oracle">=</span> <span class="constant constant_numeric constant_numeric_oracle">0</span> <span class="keyword keyword_control keyword_control_pl">then</span>
<span class="linenum">    5</span> <span class="comment comment_line comment_line_double-dash">  --</span>
<span class="linenum">    6</span> <span class="comment comment_line comment_line_double-dash">  -- Error in creation</span>
<span class="linenum">    7</span> <span class="comment comment_line comment_line_double-dash">  --</span>
<span class="linenum">    8</span>   <span class="variable variable_other">hr_utility.</span>set_message<span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="constant constant_numeric constant_numeric_oracle">801</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="string string_quoted string_quoted_single string_quoted_single_oracle">'HR_6153_ALL_PROCEDURE_FAIL'</span><span class="keyword keyword_operator keyword_operator_oracle">);</span>
<span class="linenum">    9</span>   <span class="variable variable_other">hr_utility.</span>set_message_token<span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="string string_quoted string_quoted_single string_quoted_single_oracle">'PROCEDURE'</span><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_other">l_proc</span><span class="keyword keyword_operator keyword_operator_oracle">);</span>
<span class="linenum">   10</span>   <span class="variable variable_other">hr_utility.</span>set_message_token<span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="string string_quoted string_quoted_single string_quoted_single_oracle">'STEP'</span><span class="keyword keyword_operator keyword_operator_oracle">,</span><span class="string string_quoted string_quoted_single string_quoted_single_oracle">'40'</span><span class="keyword keyword_operator keyword_operator_oracle">);</span>
<span class="linenum">   11</span>   <span class="variable variable_other">hr_utility.</span>raise_error<span class="keyword keyword_operator keyword_operator_oracle">;</span>
<span class="linenum">   12</span> <span class="comment comment_line comment_line_double-dash">  --</span>
<span class="linenum">   13</span> <span class="keyword keyword_control keyword_control_pl">end</span> <span class="keyword keyword_control keyword_control_pl">if</span><span class="keyword keyword_operator keyword_operator_oracle">;</span>
</span><span class="linenum">   14</span>
</pre>
<div class="p1">
<br />
Now, on why this is always a problem particularly on a shared HR installation is that the logic for an update is to retrieve existing values, change whatever we are interested in and leave unchanged values out from the API call as they are defaulted and properly handled. However, p_people_group_id is declared as in out and thus we can not rely on it being defaulted:</div>
<div class="p1">
<br /></div>
<pre class="textmate-source solarized_dark_"><span class="linenum">    1</span> <span class="source source_oracle"><span class="keyword keyword_operator keyword_operator_oracle">,</span> <span class="variable variable_parameter">p_people_group_id</span> <span class="keyword keyword_operator keyword_operator_oracle">in</span> <span class="keyword keyword_operator keyword_operator_oracle">out</span> <span class="storage storage_modifier storage_modifier_oracle">nocopy</span> <span class="storage storage_type storage_type_oracle">number</span>
</span><span class="linenum">    2</span> </pre>
<div class="p1">
<br /></div>
<div class="p1">
thus, we need to pass a variable in the API call. As the People Group field is not even available for data capture, the current stored value is always null, meaning that is what gets passed to the API call and, as we saw above, triggers the error to occur.</div>
<div class="p1">
<br /></div>
<div class="p1">
The solution works as the failing code call is avoided by the hr_api.g_number constant having a value (-9871234567, if you need to know) and then not branching to execute the people group flexfield validation. Later on, Oracle identifies if that constant value is passed and uses current field value instead. This happens on per_asg_upd.covert_defs, which determines if any parameter was defaulted and replaces its value with the current value stored on the corresponding record column.</div>
<div class="p1">
<br /></div>
<div class="p1">
These are the comments on the procedure<br />
<br /></div>
<pre class="textmate-source solarized_dark_"><span class="linenum">    1</span> <span class="source source_oracle"><span class="comment comment_line comment_line_double-dash">-- Description:</span>
<span class="linenum">    2</span> <span class="comment comment_line comment_line_double-dash">--   The Convert_Defs procedure has one very important function:</span>
<span class="linenum">    3</span> <span class="comment comment_line comment_line_double-dash">--   It must return the record structure for the row with all system defaulted</span>
<span class="linenum">    4</span> <span class="comment comment_line comment_line_double-dash">--   values converted into its corresponding argument value for update. When</span>
<span class="linenum">    5</span> <span class="comment comment_line comment_line_double-dash">--   we attempt to update a row through the Upd business process , certain</span>
<span class="linenum">    6</span> <span class="comment comment_line comment_line_double-dash">--   arguments can be defaulted which enables flexibility in the calling of</span>
<span class="linenum">    7</span> <span class="comment comment_line comment_line_double-dash">--   the upd process (e.g. only attributes which need to be updated need to be</span>
<span class="linenum">    8</span> <span class="comment comment_line comment_line_double-dash">--   specified). For the upd business process to determine which attributes</span>
<span class="linenum">    9</span> <span class="comment comment_line comment_line_double-dash">--   have NOT been specified we need to check if the argument has a reserved</span>
<span class="linenum">   10</span> <span class="comment comment_line comment_line_double-dash">--   system default value. Therefore, for all attributes which have a</span>
<span class="linenum">   11</span> <span class="comment comment_line comment_line_double-dash">--   corresponding reserved system default mechanism specified we need to</span>
<span class="linenum">   12</span> <span class="comment comment_line comment_line_double-dash">--   check if a system default is being used. If a system default is being</span>
<span class="linenum">   13</span> <span class="comment comment_line comment_line_double-dash">--   used then we convert the defaulted value into its corresponding attribute</span>
<span class="linenum">   14</span> <span class="comment comment_line comment_line_double-dash">--   value held in the g_old_rec data structure.</span>
</span><span class="linenum">   15</span> 
</pre>
<br />
<div class="p1">
And this is how the people_group_id is handled within the code:<br />
<br /></div>
<pre class="textmate-source solarized_dark_"><span class="linenum">    1</span> <span class="source source_oracle"><span class="keyword keyword_control keyword_control_pl">If</span> <span class="keyword keyword_operator keyword_operator_oracle">(</span><span class="variable variable_other">p_rec.</span>people_group_id <span class="keyword keyword_operator keyword_operator_oracle">=</span> <span class="variable variable_other">hr_api.g_number</span><span class="keyword keyword_operator keyword_operator_oracle">)</span> <span class="keyword keyword_control keyword_control_pl">then</span>
<span class="linenum">    2</span>   <span class="variable variable_other">p_rec.</span>people_group_id <span class="keyword keyword_operator keyword_operator_oracle">:=</span>
<span class="linenum">    3</span>   <span class="variable variable_other">per_asg_shd.g_old_rec</span><span class="keyword keyword_operator keyword_operator_oracle">.</span>people_group_id<span class="keyword keyword_operator keyword_operator_oracle">;</span>
<span class="linenum">    4</span> <span class="keyword keyword_control keyword_control_pl">End</span> <span class="keyword keyword_control keyword_control_pl">If</span><span class="keyword keyword_operator keyword_operator_oracle">;</span>
</span><span class="linenum">    5</span> 
</pre>
